//REST API SERVERSIDE

/* Preperation * / 
var multer = require('multer');

/* her lager vi navn og hvor bildet skal lagres (jeg lagrer dem i en mappe som heter imgstore) */
const storage = multer.diskStorage({
    destination: "./imgstore",
    filename: function(req, file, cb){
        cb(null,"IMG-" + Date.now() + path.extname(file.originalname));
    }
});

const upload = multer({
    storage: storage,
    limits:{fileSize: 1000000},
}).single("myImage");


app.post('/upload',function(req, res) {
    let imgsrc = "images?imgnm="; // må ha dette på begynnelsen av stringen 
    upload(req, res, (err) => {
        console.log("Request ---", req.body); // debuggg

	// legg til navnet på det lagrede bilde på den fulle bildestringen
        imgsrc = imgsrc + req.file.filename; 
        console.log(imgsrc);
        console.log("Request file ---", req.file);//Here you get file.

        if(err){
            res.status(500);
            res.data("bad imgage");
        }

	// dette er her for å laste opp artikkelen så det er litt snacks du ikke bryr deg om
        let imp = 0;
        if(req.body.importance){
            imp = 1;
        }
        let val  =  [req.body.headline, req.body.body, req.body.date, imp, req.body.categoryid,  req.body.author,  imgsrc,   req.body.imgdesc, req.body.imgalt];

	
	// lagrer i db
        Artdao.new(val, (status,data)=>{
            res.status(status);
        });
    })
});


// dette er for når klienten skal rendre bilde og så spør om den 
app.get('/images', function(req, res) {
    console.log("Klienten spurte om bildet: " + req.query.imgnm );
    res.sendFile(__dirname + "/imgstore/" + req.query.name);
});




//KLIENT SIDE

//For å laste opp er det litt stress å skille ut koden min fra det som ikke er relevant, så se på eksempelet, men hvis du vil legge til ting i req.body så gjør du det slik: 



static create(art: ArtBody, file: File){
	
	// form data pakker inn alle filene og anna data
        const formData = new FormData();
        let allVals = {headline: art.headline, body: art.body, importance: art.importance, categoryid: art.cat.id, imgsrc: art.artimg.imgsrc,  author: art.author, imgdesc: art.artimg.imgdesc, imgalt: art.artimg.imgalt, date: DateParser.getDateString(art.date)};

	// dette kan hentes ut igjen med req.body.whatever på serversiden
        formData.set("headline", art.headline);
        formData.set("body", art.body);
        formData.set("importance", art.importance);
        formData.set("categoryid", art.cat.id);
        formData.set("author", art.author);
        formData.set("imgdesc", art.artimg.imgdesc);
        formData.set("imgalt", art.artimg.imgalt);
        formData.set("date", DateParser.getDateString(art.date));

	
        formData.append('myImage',file);

        const config = {
            headers: {
                'content-type': 'multipart/form-data'
            },

        };
        return axios.post("/upload", formData, config)
            .then((response) => {

            }).catch((error) => {
        });
    }


// hente bildene fra klienserver

/*
	Alle bilder som ser slik ut: 
*/



<img src="images/?imgnm=heleneskulebilde.jpg"/>

/* vil i stedet for å lete i en mappe, gjøre en GET request til serveren undet /ettellerannet, som i mitt tilfelle er /images



